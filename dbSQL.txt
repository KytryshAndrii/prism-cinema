-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."ACTORS"
(
    actor_id uuid NOT NULL,
    first_name character varying(35) COLLATE pg_catalog."default" NOT NULL,
    middle_name character varying(35) COLLATE pg_catalog."default",
    last_name character varying(35) COLLATE pg_catalog."default" NOT NULL,
    birthplace character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT "ACTORS_pkey" PRIMARY KEY (actor_id)
);

COMMENT ON TABLE public."ACTORS"
    IS 'Table consist id of each actor and their name, middle name and surname';

CREATE TABLE IF NOT EXISTS public."ADDITIONAL_MOVIE_DATA"
(
    movie_id uuid NOT NULL,
    movie_poster bytea NOT NULL,
    movie_trailer text COLLATE pg_catalog."default" NOT NULL,
    movie_language character varying(3) COLLATE pg_catalog."default"
);

COMMENT ON TABLE public."ADDITIONAL_MOVIE_DATA"
    IS 'Table with trailer link and movie poster';

CREATE TABLE IF NOT EXISTS public."DIRECTORS"
(
    director_id uuid NOT NULL,
    first_name character varying(35) COLLATE pg_catalog."default" NOT NULL,
    middle_name character varying(35) COLLATE pg_catalog."default",
    last_name character varying(35) COLLATE pg_catalog."default" NOT NULL,
    birthplace character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT "DIRECTORS_pkey" PRIMARY KEY (director_id)
);

COMMENT ON TABLE public."DIRECTORS"
    IS 'Table consist id of each director and their name';

CREATE TABLE IF NOT EXISTS public."FAVOURITE_MOVIES"
(
    user_id uuid NOT NULL,
    movie_id uuid
);

COMMENT ON TABLE public."FAVOURITE_MOVIES"
    IS 'The joint table that joins movies and users using MANY-to-MANY connection';

CREATE TABLE IF NOT EXISTS public."GENRES"
(
    genre_id uuid NOT NULL,
    genre_name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    genre_description character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT "GENRES_pkey" PRIMARY KEY (genre_id)
);

COMMENT ON TABLE public."GENRES"
    IS 'Table of movie GENRES descriptions and ect....';

CREATE TABLE IF NOT EXISTS public."LICENSES"
(
    license_id uuid NOT NULL,
    license_region character varying(3) COLLATE pg_catalog."default" NOT NULL,
    license_expiration_date date NOT NULL,
    CONSTRAINT "LICENSES_pkey" PRIMARY KEY (license_id)
);

COMMENT ON TABLE public."LICENSES"
    IS 'Table that include licenses for exact film';

CREATE TABLE IF NOT EXISTS public."MOVIES"
(
    movie_id uuid NOT NULL,
    movie_name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    movie_rating double precision DEFAULT 0.0,
    movie_release_date date NOT NULL,
    movie_pg character varying(10) COLLATE pg_catalog."default" NOT NULL,
    movie_description character varying(255) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "MOVIES_pkey" PRIMARY KEY (movie_id)
);

COMMENT ON TABLE public."MOVIES"
    IS 'Table of movies with their meta data and id';

CREATE TABLE IF NOT EXISTS public."MOVIE_ACTORS"
(
    movie_id uuid NOT NULL,
    actor_id uuid NOT NULL
);

COMMENT ON TABLE public."MOVIE_ACTORS"
    IS 'Table that join actors and movies together. MANY-to-MANY';

CREATE TABLE IF NOT EXISTS public."MOVIE_DIRECTORS"
(
    movie_id uuid NOT NULL,
    director_id uuid NOT NULL
);

COMMENT ON TABLE public."MOVIE_DIRECTORS"
    IS 'Table that join directors and movies together. MANY-to-MANY';

CREATE TABLE IF NOT EXISTS public."MOVIE_GENRES"
(
    movie_id uuid NOT NULL,
    genre_id uuid NOT NULL
);

COMMENT ON TABLE public."MOVIE_GENRES"
    IS 'Table that join movies genres and movies and are related to them in MANY-to-MANY';

CREATE TABLE IF NOT EXISTS public."MOVIE_LICENSES"
(
    movie_id uuid NOT NULL,
    license_id uuid NOT NULL
);

COMMENT ON TABLE public."MOVIE_LICENSES"
    IS 'Join table MANY-to-MANY';

CREATE TABLE IF NOT EXISTS public."MOVIE_LOCALIZATIONS"
(
    movie_id uuid NOT NULL,
    subtitles_language character varying(3) COLLATE pg_catalog."default",
    subtitles json
);

CREATE TABLE IF NOT EXISTS public."SERVICE_SUBSCRIPTION_PLANS"
(
    subscription_plan_id uuid NOT NULL,
    subscription_plan_type character varying(50) COLLATE pg_catalog."default" NOT NULL,
    subscription_plan_cost integer NOT NULL,
    CONSTRAINT "SERVICE_SUBSCRIPTION_PLANS_pkey" PRIMARY KEY (subscription_plan_id)
);

COMMENT ON TABLE public."SERVICE_SUBSCRIPTION_PLANS"
    IS 'Table that consist of plans that are able for user to choose from';

CREATE TABLE IF NOT EXISTS public."USERS"
(
    user_id uuid NOT NULL,
    user_login character varying(16) COLLATE pg_catalog."default" NOT NULL,
    user_password character varying(255) COLLATE pg_catalog."default" NOT NULL,
    user_mail character varying(255) COLLATE pg_catalog."default" NOT NULL,
    user_is_subscribed boolean NOT NULL,
    user_subscription_plan_id uuid,
    user_subscription_period daterange,
    user_is_admin boolean NOT NULL,
    user_location_region character varying(3) COLLATE pg_catalog."default" NOT NULL,
    user_date_of_birth date NOT NULL,
    CONSTRAINT "USERS_pkey" PRIMARY KEY (user_id)
);

COMMENT ON TABLE public."USERS"
    IS 'Table which will consist users';

ALTER TABLE IF EXISTS public."ADDITIONAL_MOVIE_DATA"
    ADD CONSTRAINT "Movie id" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Movie id" ON public."ADDITIONAL_MOVIE_DATA"
    IS 'FK to PK of movies table';



ALTER TABLE IF EXISTS public."FAVOURITE_MOVIES"
    ADD CONSTRAINT "Movie Id" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

COMMENT ON CONSTRAINT "Movie Id" ON public."FAVOURITE_MOVIES"
    IS 'FK to movies table';



ALTER TABLE IF EXISTS public."FAVOURITE_MOVIES"
    ADD CONSTRAINT "User id" FOREIGN KEY (user_id)
    REFERENCES public."USERS" (user_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

COMMENT ON CONSTRAINT "User id" ON public."FAVOURITE_MOVIES"
    IS 'FK for user in users table ';



ALTER TABLE IF EXISTS public."MOVIE_ACTORS"
    ADD CONSTRAINT "Actor key" FOREIGN KEY (actor_id)
    REFERENCES public."ACTORS" (actor_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Actor key" ON public."MOVIE_ACTORS"
    IS 'FK for actors table ids. MANY-to_MANY';



ALTER TABLE IF EXISTS public."MOVIE_ACTORS"
    ADD CONSTRAINT "Movie key" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Movie key" ON public."MOVIE_ACTORS"
    IS 'FK for movies table';



ALTER TABLE IF EXISTS public."MOVIE_DIRECTORS"
    ADD CONSTRAINT "Director key" FOREIGN KEY (director_id)
    REFERENCES public."DIRECTORS" (director_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Director key" ON public."MOVIE_DIRECTORS"
    IS 'FK for directors table and their ids, MANY-to-MANY';



ALTER TABLE IF EXISTS public."MOVIE_DIRECTORS"
    ADD CONSTRAINT "Movie key" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

COMMENT ON CONSTRAINT "Movie key" ON public."MOVIE_DIRECTORS"
    IS 'KF for movies table and its id. MANY-to-MANY';



ALTER TABLE IF EXISTS public."MOVIE_GENRES"
    ADD CONSTRAINT "Genre id" FOREIGN KEY (genre_id)
    REFERENCES public."GENRES" (genre_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Genre id" ON public."MOVIE_GENRES"
    IS 'FK for genres table';



ALTER TABLE IF EXISTS public."MOVIE_GENRES"
    ADD CONSTRAINT "Movie id" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

COMMENT ON CONSTRAINT "Movie id" ON public."MOVIE_GENRES"
    IS 'FK for movie table';



ALTER TABLE IF EXISTS public."MOVIE_LICENSES"
    ADD CONSTRAINT "LICENSE_ID FK" FOREIGN KEY (license_id)
    REFERENCES public."LICENSES" (license_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."MOVIE_LICENSES"
    ADD CONSTRAINT "MOVIE_ID FK" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH FULL
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."MOVIE_LOCALIZATIONS"
    ADD CONSTRAINT "MOVIE_LOCALIZATIONS_movie_id_fkey" FOREIGN KEY (movie_id)
    REFERENCES public."MOVIES" (movie_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public."USERS"
    ADD CONSTRAINT "USERS_user_subscription_plan_id_fkey" FOREIGN KEY (user_subscription_plan_id)
    REFERENCES public."SERVICE_SUBSCRIPTION_PLANS" (subscription_plan_id) MATCH SIMPLE
    ON UPDATE CASCADE
    ON DELETE CASCADE;

END;